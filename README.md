# SPACE4AI-D

A Design-time Tool for AI applications Resource Selection  in Computing Continua

### Docker image generation

As the first step get clone from space4ai-d repository and go to the corresponding directory which includes Dockerfile:
```
git clone https://gitlab.polimi.it/ai-sprint/space4ai-d.git
cd space4ai-d
```
When building the docker image for the `SPACE4AI-D`, this is 
installed in a `/home/SPACE4AI-D` directory, which includes a
version of entrypoint integrated with AISPRINT  (Run_and_Evaluate_integrate_AISPRINT.py). This entrypoint uses [SPACE4AI-Parser](https://gitlab.polimi.it/ai-sprint/space4ai-parser) to convert input/output JSON files into YAML files and vice versa.

The image should be generated by executing different commands, depending on 
whether you intend to use the parser for development (`image-dev`) or in a production (`image-prod`) scenario.
 Indeed, when the docker image is generated, the parser 
code is cloned into the `/home/SPACE4AI-D` directory. 

#### Docker image for development

When building under the `image-dev` setting, the most recent version of the 
parser is cloned from the corresponding git repository. The docker image 
should be generated as follows:

```
IMG_TARGET=image-dev
IMG_NAME=aisprint/space4ai-d
IMG_TAG=dev
docker build --target ${IMG_TARGET} -t ${IMG_NAME}:${IMG_TAG} .
```

#### Docker image for production

When using the `image-prod` target, instead, a specific version of the 
SPACE4AI Parser is considered. By default, executing the following command, 
the latest tagged version of the parser is considered:

```
IMG_TARGET=image-prod
IMG_NAME=aisprint/space4ai-d
IMG_TAG=23.06.29b
docker build --target ${IMG_TARGET} -t ${IMG_NAME}:${IMG_TAG} .
```

To consider a specific 
[parser version](https://gitlab.polimi.it/ai-sprint/space4ai-parser/-/tags), 
run:

```
IMG_TARGET=image-prod
IMG_NAME=aisprint/space4ai-d
IMG_TAG=23.06.29b
PARSER_TAG=23.06.30
docker build  --target ${IMG_TARGET} \
              --build-arg PARSER_TAG=${PARSER_TAG} \
              -t ${IMG_NAME}:${IMG_TAG} .
```

### Start the container

To start the docker container in interactive mode, run:

```
CONT_NAME=s4aid
PATH_TO_VOLUME=${PWD}/example_applications
MOUNT_POINT=/mnt
docker run  -it \
            --name ${CONT_NAME} \
            -e MOUNT_POINT=${MOUNT_POINT} \
            -v ${PATH_TO_VOLUME}:${MOUNT_POINT} \
            ${IMG_NAME}:${IMG_TAG}
```

where `PATH_TO_VOLUME` is the (global) path to the volume where the 
application directory is stored. Examples of the application directory can be downloaded from the 
[AI-SPRINT Examples](https://gitlab.polimi.it/ai-sprint/ai-sprint-examples) 
following the instructions [here](example_applications/README.md).

Once the container started, the script parses the input YAML files available in the 
application directory to generate the JSON inputs consumed by the tool. When the tool finds the optimal solution and writes it in a JSON file, the parser converts the output JSON into a YAML file. 

## Execution instructions

If you would like to use space4ai-d indipendent of AISPRINT, you don't need to run the parser. `Run_and_Evaluate.py` is the entrypoint to run `SPACE4AI-D` independently, that is called from the command-line with the following prototype:

```
usage: Run_and_Evaluate.py [-h] [-s] [-L] [-c] 
                     [-v] [-e] [-l]
                     


optional arguments:
  -h, --help            Show this help message and exit
  -s,  --system_file    Path to the system JSON file
  -L,  --Lambda         Input workload
  -c, --config          Input configuration file (Input.json)
  -v, --verbose         Verbosity level for logging (type:int)
  -e, --evaluation_lambda  
  -l, --log_directory   Directory for logging  
```

This script can be used for two proposes:
1. **Finding an optimal solution for a system**

    For this propose, the following parameters are mandatory for this    script:
    * system JSON file, which is the information of system described in a json file.
    * Input configuration file (JSON), which includes the computational layes belong to Edge, Cloud and FaaS and the name of methods and the corresponding parameters. 

    **Optional parameter:**
    * Lambda, the input workload for the application. If Lambda is specified by this filed, the script ignore the Lambda in sysstem json file.


2. **Evaluating a specific solution with a specific Lambda**

    For this propose, the following parameters are mandatory for this    script:
    * system JSON file, which is the information of system described in a json file.
    * evaluation_lambda, which is a list of two arguments, the first one is Lambda and the second one is the path of the solution file (in JSON format) to be evaluated. 







